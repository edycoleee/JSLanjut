<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
    <title>PELAJARAN 11</title>
</head>

<body>
    <div class="grid-container">
        <div class="nav-center">
            <!-- nav header -->
            <div class="nav-header">
                <img src="./logo.svg" class="logo" alt="logo1">
                <button class="nav-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <div class="menuAtas">
            <a href="/">HOME</a> | <a href="">kosong</a>
        </div>
        <div class="judul">
            <h3>Routing, Post, NeDB</h3>
        </div>
        <div class="isiHalaman">
            <section class="section-center">
                <p>lihat di script <b>dibawah </b></p>
                <table style="width:100%">
                    <tr>
                        <th>
                            1. package.json
                        </th>
                        <td>
                            <p></p>{"name": "module2","version": "1.0.0","description": "dataku",
                            <p></p>"main":" <span class="rnthl rntclred">index.js</span>","
                            <p></p>"scripts":{"test": "echo \"Error: no test specified\" && exit 1"},
                            <p></p>"keywords": ["example","data","selfie"],"author": "edy cole","license": "MIT",
                            <p></p><span class="rnthl rntclblue">"dependencies"</span>
                            : {"dotenv": "^8.2.0","express": "^4.17.1","nedb": "^1.8.0","node-fetch": "^2.6.0"}}
                        </td>
                    </tr>
                    <tr>
                        <th rowspan="2">2. index.js</th>
                        <td>//1. require express dan nedb <p></p>
                            const express = require("express");
                            const Datastore = require("nedb");
                            const fetch = require("node-fetch");
                            require('dotenv').config();
                            console.log(process.env);</td>
                    </tr>
                    <tr>
                        <td>//2. create app <p></p>
                            const app = express();
                            //listen port
                            app.listen(3000, () => console.log("listening at 3000"));
                            // mengarahkan bahwa http://127.0.0.1:3000/ ke public/index.html
                            app.use(express.static("public"));
                            // express siap menggunakan json
                            app.use(express.json({ limit: "1mb" }));
                            const database = new Datastore("database.db");
                            database.loadDatabase();
                            //database.insert({ name:'silmi', status :'adik'})
                            //database.insert({ name:'afin', status :'kakak'})
                    </tr>

                    <tr>
                        <th>3. membuat POST
                        </th>
                        <td>
                            lihat di script
                        </td>
                    </tr>
                    <tr>
                        <th>4. membuat GET
                        </th>
                        <td> lihat di script</td>
                    </tr>
                </table>
                <p></p>

            </section>
        </div>
        <div class="footer">
            <a href="/">HOME</a> | <a href="">kosong</a>
        </div>
    </div>
    <script>
        // //isi dari index.js adalah sebagai berikut
        // //1. require express dan nedb
        // const express = require("express");
        // const Datastore = require("nedb");
        // const fetch = require("node-fetch");
        // require('dotenv').config();
        // console.log(process.env);


        // //2. create app
        // const app = express();
        // //listen port
        // app.listen(3000, () => console.log("listening at 3000"));
        // // mengarahkan bahwa http://127.0.0.1:3000/ ke public/index.html
        // app.use(express.static("public"));
        // // express siap menggunakan json
        // app.use(express.json({
        //     limit: "1mb"
        // }));

        // const database = new Datastore("database.db");
        // database.loadDatabase();
        // //database.insert({ name:'silmi', status :'adik'})
        // //database.insert({ name:'afin', status :'kakak'})

        // //3. saat ada post dengan alamat /api maka akan respon
        // // perintah utk mendapatkan data dari client dan mengirim hasil ke client (POST)
        // app.post("/api", (request, response) => {
        //     console.log("request sukses");
        //     console.log(request.body);
        //     const timestamp = Date.now();
        //     const data = request.body;
        //     data.timestamp = timestamp;
        //     database.insert(data);
        //     // respon jika server telah menerima data dri client
        //     response.json({
        //         status: "sukses",
        //         latitude: data.lat,
        //         timestamp: timestamp,
        //         longitude: data.lon,
        //     });
        // });

        // //4. respon kirim data request dari client (GET)
        // app.get("/api", (request, response) => {
        //     //mencoba response
        //     //response.json({test : 123})
        //     //find data pada database=>kirim semua data
        //     database.find({}, (err, data) => {
        //         if (err) {
        //             response.end();
        //             return;
        //         }
        //         response.json(data);
        //     });
        // });

        // //5. respon ambil data dari cloud endpoint
        // // mebutuhkan paket npm install node-fetch
        // // untuk mengambil kota dari client->server->cloud
        // // melempar data cloud->server->client dibutuhkan route
        // app.get("/weather/:kota", async (request, response) => {
        //     console.log(request.params);
        //     const kota = request.params.kota;
        //     console.log(kota);
        //     //const api_key = '999ab7e8c4b9696588efeb00c223db260c677a4d'
        //     const api_key = process.env.API_KEY
        //     const api_url = `http://api.waqi.info/feed/${kota}/?token=${api_key}`;
        //     //const api_url = `http://api.waqi.info/feed/jakarta/?token=999ab7e8c4b9696588efeb00c223db260c677a4d`;
        //     const ambil_resp = await fetch(api_url);
        //     const dataku = await ambil_resp.json();
        //     response.json(dataku);
        //     //console.log(dataku.data.city.geo);
        // });
    </script>
</body>

</html>